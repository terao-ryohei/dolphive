# Dolphive

Dolphin（イルカ）+ Archive（保管庫）= イルカのように賢く記憶を保管するサービス。

Discord上の会話を自動で分析して保存してくれる、あなた専用の記憶アシスタントBotです。

## Dolphive でできること

### メモを自動で保存

チャンネルでの発言を Dolphive が自動で検知し、大事そうな内容を保存提案してくれます。「覚えておいて」「メモして」と話しかけるだけでも保存できます。保存前には必ずプレビューが表示されるので、内容を確認してからワンクリックで保存できます。

### カテゴリチャンネルで即時保存

`#daily`、`#ideas`、`#tasks` など、カテゴリ名を含むチャンネルでの発言は自動的に対応カテゴリで保存提案されます。

| カテゴリ | チャンネル名の例 |
|---------|----------------|
| 日記 | #daily, #日記 |
| アイデア | #ideas, #アイデア |
| 調査 | #research, #調査 |
| 画像 | #images, #画像 |
| 作業ログ | #logs, #作業ログ |
| 予定 | #schedule, #予定 |
| タスク | #tasks, #タスク |

### 会話に参加（対話機能）

特定のチャンネルでは Dolphive が会話に参加し、過去に保存したメモリを活かして返答します。Dolphive は「ドルフィーヴ」というイルカのキャラクターとして、親しみやすい口調で会話します。

**対話が有効になるチャンネル:**

- **自動判定**: チャンネル名に「雑談」「一般」「general」「chat」「random」「おしゃべり」「フリートーク」が含まれていれば自動的に有効
- **手動指定**: 環境変数 `CHAT_CHANNEL_IDS` でチャンネルIDを直接指定することも可能

自動判定と手動指定は併用できます。どちらか一方に該当すれば対話が有効になります。

> **注意**: 対話チャンネルでも「覚えておいて」等の保存キーワードが検出された場合は、メモ保存が優先されます（対話応答は行われません）。

### メモの検索・管理

保存したメモはいつでも検索・編集・削除できます。

- `/save [category]` — 直前の会話をメモとして保存（プレビュー確認あり）
- `/search キーワード` — メモをキーワードで検索
- `/recent` — 最近のメモを表示
- `/categories` — カテゴリ別の件数を表示
- `/delete キーワード` — メモを削除
- `/edit` — メモを編集（keyword, field, value をそれぞれ入力）

### リマインダー

`/remind` でリマインダーを設定できます。指定した時間になると Dolphive が通知してくれます。

## はじめかた

### 1. Discord Bot を招待する

[Discord Developer Portal](https://discord.com/developers/applications) でBotを作成し、サーバーに招待します。

> **重要**: Developer Portal の Bot 設定で **Message Content Intent** を必ず有効にしてください。これが無効だとメッセージ本文を読み取れず、自動保存・対話応答が動作しません。

### 2. 環境変数を設定する

`.env.example` を `.env` にコピーし、以下の値を設定します:

- `DISCORD_TOKEN` — Discord Botトークン
- `GLM_API_KEY` — AI APIキー
- `GITHUB_TOKEN` — GitHubトークン
- `GITHUB_OWNER` — GitHubユーザー名
- `GITHUB_REPO` — メモリ保存先リポジトリ名

### 3. 起動する

```bash
npm install
npm run build
npm start
```

## 知っておくべきこと

### DISCORD_CHANNEL_ID について

`DISCORD_CHANNEL_ID` を設定している場合、Dolphive はそのチャンネルのみを監視します。対話機能の自動判定や `CHAT_CHANNEL_IDS` で指定したチャンネルも、このスコープ内でなければ機能しません。

### CHAT_CHANNEL_IDS（手動指定）と自動判定の併用

- `CHAT_CHANNEL_IDS` にチャンネルIDを指定すると、チャンネル名に関係なくそのチャンネルで対話が有効になります
- チャンネル名による自動判定は `CHAT_CHANNEL_IDS` の設定有無に関わらず動作します
- 両方の条件が重なっても問題ありません（OR条件）

### データの分離

サーバーごとにメモリは完全に分離されています。他のサーバーのメモが混ざることはありません。DMでのやり取りもユーザーごとに分離されます。

## ライセンス

MIT
